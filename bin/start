#!/usr/bin/env ruby
require_relative "./helpers.rb"
system('docker compose -f docker/docker-compose.yml up -d')

puts "Indexing with SPHINX"
container_exec('sphinx', 'indexer --all --config /opt/sphinx/conf/sphinx.conf --rotate')

puts "DB Migrate"
container_bash_exec('rails', 'rake db:migrate')

puts "Launching Puma"
container_bash_exec('rails', 'bundle exec puma -C config/_PUMA.rb', detached = true)

puts "Launching Sidekiq"
container_bash_exec('rails', 'bundle exec sidekiq -C config/_SIDEKIQ.yml', detached = true)

containers_information
